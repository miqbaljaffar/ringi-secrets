<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新規稟議申請 (税務) | 稟議書管理システム</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/contract_form.css">
</head>
<body>

<div id="app" class="container">
    <h1>新規稟議申請 (税務契約)</h1>

    <form @submit.prevent="submitForm" id="taxContractForm" method="POST">
        
        <!-- HEADER -->
        <div class="section">
            <div class="form-group">
                <label class="form-label required">稟議書種別</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="doc_type" value="contract" checked> 契約稟議 (税務)</label>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label required" for="applied_date">申請日</label>
                <div class="form-control-wrapper">
                     <input type="date" id="applied_date" name="applied_date" v-model="form.applied_date" readonly>
                </div>
            </div>
        </div>

        <h2>基本情報 (Basic Info)</h2>
        <div class="section">
            <div class="form-group">
                <label class="form-label required">法人・個人区分</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="corp_type" value="1" v-model="form.corp_type"> 法人</label>
                    <label><input type="radio" name="corp_type" value="2" v-model="form.corp_type"> 個人</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required" for="company_name">商号、屋号</label>
                <div class="form-control-wrapper">
                    <input type="text" id="company_name" name="company_name" v-model="form.company_name" placeholder="例：株式会社アイワークス" required>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required" for="company_kana">フリガナ</label>
                <div class="form-control-wrapper">
                    <input type="text" id="company_kana" name="company_kana" v-model="form.company_kana" placeholder="自動入力" readonly>
                </div>
            </div>
            
            <div v-if="isCorporate">
                <div class="form-group">
                    <label class="form-label required" for="establishment_date">設立年月日</label>
                    <div class="form-control-wrapper">
                        <input type="date" id="establishment_date" name="establishment_date" v-model="form.establishment_date">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="capital">資本金</label>
                    <div class="form-control-wrapper">
                        <input type="text" id="capital" name="capital" :value="form.capital | formatNumber" @input="updateNumber($event, 'capital')" class="input-mid text-right"> 円
                    </div>
                </div>
            </div>

            <div class="section-sub-title">業種情報</div>
            
            <div class="form-group">
                <label class="form-label required" for="industry_name">業種名</label>
                <div class="form-control-wrapper">
                    <input type="text" id="industry_name" name="industry_name" v-model="form.industry_name" placeholder="例：ソフトウェア開発業" required>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required">業種コード (産業分類)</label>
                <div class="form-control-wrapper flex-row">
                    <select id="industry_cat_1" name="industry_cat_1" v-model="form.industry_cat_1" class="input-short" required>
                        <option value="" disabled>大</option>
                        <option v-for="c in 'ABCDEFGHIJKLMNOPQRST'" :value="c">{{c}}</option>
                    </select>
                    <input type="text" id="industry_cat_2" name="industry_cat_2" v-model="form.industry_cat_2" maxlength="2" class="input-short" placeholder="中(01)" required>
                    <input type="text" id="industry_cat_3" name="industry_cat_3" v-model="form.industry_cat_3" maxlength="1" class="input-short" placeholder="小(1)" required>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required" for="industry_oms">業種コード (OMS)</label>
                <div class="form-control-wrapper">
                    <input type="text" id="industry_oms" name="industry_oms" v-model="form.industry_oms" maxlength="4" class="input-mid" placeholder="0000" required>
                </div>
            </div>

            <div class="section-sub-title">税務・住所情報</div>

            <div class="form-group">
                <label class="form-label required" for="closing_month">決算月</label>
                <div class="form-control-wrapper">
                    <select id="closing_month" name="closing_month" v-model="form.closing_month" class="input-short">
                        <option v-for="n in 12" :value="n">{{ n }}月</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label required">申告区分</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="declaration_type" value="blue" v-model="form.declaration_type"> 青色</label>
                    <label><input type="radio" name="declaration_type" value="white" v-model="form.declaration_type"> 白色</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required">納税地区分</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="tax_place" value="1" v-model="form.tax_place"> 事業所</label>
                    <label><input type="radio" name="tax_place" value="2" v-model="form.tax_place"> 自宅</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required" for="tax_office_name">管轄税務署</label>
                <div class="form-control-wrapper">
                    <input type="text" id="tax_office_name" name="tax_office_name" v-model="form.tax_office_name" required>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label required" for="tax_number">納税No</label>
                <div class="form-control-wrapper">
                    <input type="text" id="tax_number" name="tax_number" v-model="form.tax_number" maxlength="8" placeholder="12345678" required>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required">事業所住所</label>
                <div class="form-control-wrapper">
                    <div style="width: 100%; margin-bottom: 5px;">
                        〒 <input type="text" id="zip1" name="zip1" v-model="form.zip1" class="input-short" maxlength="3"> - 
                        <input type="text" id="zip2" name="zip2" v-model="form.zip2" class="input-short" maxlength="4">
                        <button type="button" class="btn-secondary btn-sm" @click="searchAddress('office')">住所検索</button>
                    </div>
                    <input type="text" id="address" name="address" v-model="form.address" style="width: 100%; margin-bottom: 5px;" placeholder="住所" required>
                    <input type="text" id="address2" name="address2" v-model="form.address2" style="width: 100%;" placeholder="ビル名・階数">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label required">事業所TEL</label>
                <div class="form-control-wrapper flex-row">
                    <input type="text" id="tel1" name="tel1" v-model="form.tel1" class="input-short"> - 
                    <input type="text" id="tel2" name="tel2" v-model="form.tel2" class="input-short"> - 
                    <input type="text" id="tel3" name="tel3" v-model="form.tel3" class="input-short">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required">郵送先</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="send_to" value="1" v-model="form.send_to"> 事業所</label>
                    <label><input type="radio" name="send_to" value="2" v-model="form.send_to"> 代表者自宅</label>
                    <label><input type="radio" name="send_to" value="9" v-model="form.send_to"> その他</label>
                </div>
            </div>
            <div class="form-group" v-if="form.send_to == '9'">
                 <label class="form-label" for="send_to_others">郵送先 (その他)</label>
                 <div class="form-control-wrapper">
                     <input type="text" id="send_to_others" name="send_to_others" v-model="form.send_to_others" placeholder="その他の郵送先住所">
                 </div>
            </div>
        </div>

        <h2>代表者情報 (Representative)</h2>
        <div class="section">
            <div class="form-group">
                <label class="form-label required">代表者氏名</label>
                <div class="form-control-wrapper flex-row">
                    <input type="text" id="rep_name_sei" name="rep_name_sei" v-model="form.rep_name_sei" placeholder="姓" class="input-mid" required>
                    <input type="text" id="rep_name_mei" name="rep_name_mei" v-model="form.rep_name_mei" placeholder="名" class="input-mid" required>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label required">代表者フリガナ</label>
                <div class="form-control-wrapper flex-row">
                    <input type="text" id="rep_kana_sei" name="rep_kana_sei" v-model="form.rep_kana_sei" placeholder="セイ" class="input-mid" required>
                    <input type="text" id="rep_kana_mei" name="rep_kana_mei" v-model="form.rep_kana_mei" placeholder="メイ" class="input-mid" required>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label required">肩書き</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="rep_title" value="1" v-model="form.rep_title"> 代表取締役</label>
                    <label><input type="radio" name="rep_title" value="2" v-model="form.rep_title"> 取締役</label>
                    <label><input type="radio" name="rep_title" value="9" v-model="form.rep_title"> その他</label>
                    <input type="text" id="rep_title_others" name="rep_title_others" v-model="form.rep_title_others" class="input-mid" v-if="form.rep_title == '9'" placeholder="その他肩書き">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label required" for="rep_email">メールアドレス</label>
                <div class="form-control-wrapper">
                     <input type="email" id="rep_email" name="rep_email" v-model="form.rep_email" placeholder="representative@example.com" required>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required" for="rep_birth">生年月日</label>
                <div class="form-control-wrapper">
                    <input type="date" id="rep_birth" name="rep_birth" v-model="form.rep_birth" required>
                </div>
            </div>

            <div class="section-sub-title">代表者自宅情報 (Penting untuk DB)</div>
            <div class="form-group">
                <label class="form-label required">自宅住所</label>
                <div class="form-control-wrapper">
                    <div style="width: 100%; margin-bottom: 5px;">
                        〒 <input type="text" id="rep_zip1" v-model="form.rep_zip1" class="input-short" maxlength="3"> - 
                        <input type="text" id="rep_zip2" v-model="form.rep_zip2" class="input-short" maxlength="4">
                        <button type="button" class="btn-secondary btn-sm" @click="searchAddress('home')">住所検索</button>
                    </div>
                    <input type="text" id="rep_address" v-model="form.rep_address" style="width: 100%; margin-bottom: 5px;" placeholder="住所" required>
                    <input type="text" id="rep_address2" v-model="form.rep_address2" style="width: 100%;" placeholder="マンション名等">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label required">自宅TEL</label>
                <div class="form-control-wrapper flex-row">
                    <input type="text" v-model="form.rep_tel1" class="input-short" required> - 
                    <input type="text" v-model="form.rep_tel2" class="input-short" required> - 
                    <input type="text" v-model="form.rep_tel3" class="input-short" required>
                </div>
            </div>
        </div>
        
        <h2>電子申告 (E-Filing)</h2>
        <div class="section">
            <div class="form-group">
                 <label class="form-label required">電子申告開始届</label>
                 <div class="form-control-wrapper">
                     <label><input type="radio" name="e_filing" value="1" v-model="form.e_filing"> 要 (Ya)</label>
                     <label><input type="radio" name="e_filing" value="2" v-model="form.e_filing"> 不要 (Tidak)</label>
                 </div>
            </div>
            <div class="form-group" v-if="form.e_filing == '1'">
                <label class="form-label" for="e_filing_reason">開始届理由</label>
                <div class="form-control-wrapper">
                    <textarea id="e_filing_reason" name="e_filing_reason" v-model="form.e_filing_reason" style="height: 60px;"></textarea>
                </div>
            </div>
            <div class="form-group">
                 <label class="form-label" for="national_tax_id">国税利用者ID</label>
                 <div class="form-control-wrapper">
                     <input type="text" id="national_tax_id" name="national_tax_id" v-model="form.national_tax_id" class="input-mid" maxlength="16">
                 </div>
            </div>
            <div class="form-group">
                 <label class="form-label" for="national_tax_pw">国税暗証番号</label>
                 <div class="form-control-wrapper">
                     <input type="text" id="national_tax_pw" name="national_tax_pw" v-model="form.national_tax_pw" class="input-mid">
                 </div>
            </div>
            <div class="form-group">
                <label class="form-label" for="local_tax_id">地方税利用者ID</label>
                <div class="form-control-wrapper">
                    <input type="text" id="local_tax_id" name="local_tax_id" v-model="form.local_tax_id" class="input-mid" maxlength="16">
                </div>
           </div>
           <div class="form-group">
                <label class="form-label" for="local_tax_pw">地方税暗証番号</label>
                <div class="form-control-wrapper">
                    <input type="text" id="local_tax_pw" name="local_tax_pw" v-model="form.local_tax_pw" class="input-mid">
                </div>
           </div>
        </div>

        <h2>会社概要・経理状況 (Financials)</h2>
        <div class="section">
            <div class="form-group">
                <label class="form-label">直前期財務データ</label>
                <div class="form-control-wrapper financial-grid">
                    <div class="fin-item">
                        <label for="fin_assets">総資産 (Assets)</label>
                        <div class="input-with-unit">
                            <input type="text" id="fin_assets" name="fin_assets" :value="form.fin_assets | formatNumber" @input="updateNumber($event, 'fin_assets')" class="text-right">
                            <span>円</span>
                        </div>
                    </div>
                    <div class="fin-item">
                        <label for="fin_sales">売上高 (Sales)</label>
                        <div class="input-with-unit">
                             <input type="text" id="fin_sales" name="fin_sales" :value="form.fin_sales | formatNumber" @input="updateNumber($event, 'fin_sales')" class="text-right">
                             <span>円</span>
                        </div>
                    </div>
                    <div class="fin-item">
                        <label for="fin_debt">金融債務 (Debt)</label>
                        <div class="input-with-unit">
                            <input type="text" id="fin_debt" name="fin_debt" :value="form.fin_debt | formatNumber" @input="updateNumber($event, 'fin_debt')" class="text-right">
                            <span>円</span>
                        </div>
                    </div>
                    <div class="fin-item">
                        <label for="fin_income">当期利益 (Income)</label>
                        <div class="input-with-unit">
                            <input type="text" id="fin_income" name="fin_income" :value="form.fin_income | formatNumber" @input="updateNumber($event, 'fin_income')" class="text-right">
                            <span>円</span>
                        </div>
                    </div>
                    <div class="fin-item">
                        <label for="fin_workers">従事者数 (Workers)</label>
                        <div class="input-with-unit">
                            <input type="number" id="fin_workers" name="fin_workers" v-model="form.fin_workers" class="text-right">
                            <span>名</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">消費税区分</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="consumption_tax" value="1" v-model="form.consumption_tax"> 本則 (Standard)</label>
                    <label><input type="radio" name="consumption_tax" value="2" v-model="form.consumption_tax"> 簡易 (Simplified)</label>
                    <label><input type="radio" name="consumption_tax" value="3" v-model="form.consumption_tax"> 免税 (Exempt)</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">貿易・関連会社</label>
                <div class="form-control-wrapper">
                     <span class="sub-label">貿易:</span>
                     <label><input type="radio" name="trade_type" value="0" v-model="form.trade_type"> なし</label>
                     <label><input type="radio" name="trade_type" value="1" v-model="form.trade_type"> 輸入</label>
                     <label><input type="radio" name="trade_type" value="2" v-model="form.trade_type"> 輸出</label>
                     <label><input type="radio" name="trade_type" value="3" v-model="form.trade_type"> 輸出入</label>
                     
                     <span class="sub-label" style="margin-left: 15px;">関連会社:</span>
                     <label><input type="radio" name="affiliated_company" value="0" v-model="form.affiliated_company"> なし</label>
                     <label><input type="radio" name="affiliated_company" value="1" v-model="form.affiliated_company"> あり</label>
                </div>
            </div>

            <div class="section-sub-title">経理の現況 (Accounting Status)</div>

            <div class="form-group">
                <label class="form-label">自計化状況</label>
                <div class="form-control-wrapper vertical-radio">
                    <label><input type="radio" name="self_accounting" value="1" v-model="form.self_accounting"> 自計化 (Self)</label>
                    <label><input type="radio" name="self_accounting" value="2" v-model="form.self_accounting"> 半自計化 (Semi)</label>
                    <label><input type="radio" name="self_accounting" value="3" v-model="form.self_accounting"> 伝票・帳簿等作成</label>
                    <label><input type="radio" name="self_accounting" value="4" v-model="form.self_accounting"> 原始記録のみ(整理済み)</label>
                    <label><input type="radio" name="self_accounting" value="5" v-model="form.self_accounting"> 原始記録のみ(未整理)</label>
                    <div class="flex-row">
                        <label><input type="radio" name="self_accounting" value="9" v-model="form.self_accounting"> その他</label>
                        <input type="text" id="self_accounting_others" name="self_accounting_others" v-model="form.self_accounting_others" v-if="form.self_accounting == '9'" placeholder="内容" class="input-mid">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">会計ソフト</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="accounting_soft" value="1" v-model="form.accounting_soft"> TKC</label>
                    <label><input type="radio" name="accounting_soft" value="2" v-model="form.accounting_soft"> 弥生会計</label>
                    <label><input type="radio" name="accounting_soft" value="3" v-model="form.accounting_soft"> 勘定奉行</label>
                    <label><input type="radio" name="accounting_soft" value="4" v-model="form.accounting_soft"> MoneyForward</label>
                    <label><input type="radio" name="accounting_soft" value="8" v-model="form.accounting_soft"> 未利用</label>
                    <div class="flex-row" style="display:inline-flex;">
                        <label><input type="radio" name="accounting_soft" value="9" v-model="form.accounting_soft"> その他</label>
                        <input type="text" id="accounting_soft_others" name="accounting_soft_others" v-model="form.accounting_soft_others" v-if="form.accounting_soft == '9'" placeholder="ソフト名" class="input-mid">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">作成している帳簿<br><span class="note">(複数選択可)</span></label>
                <div class="form-control-wrapper checkbox-grid">
                    <label><input type="checkbox" name="books" value="1" v-model="form.books"> 現金出納帳</label>
                    <label><input type="checkbox" name="books" value="2" v-model="form.books"> 預金出納帳</label>
                    <label><input type="checkbox" name="books" value="3" v-model="form.books"> 売掛金元帳</label>
                    <label><input type="checkbox" name="books" value="4" v-model="form.books"> 買掛金元帳</label>
                    <label><input type="checkbox" name="books" value="5" v-model="form.books"> 手形記入帳</label>
                    <label><input type="checkbox" name="books" value="6" v-model="form.books"> 固定資産台帳</label>
                    <label><input type="checkbox" name="books" value="7" v-model="form.books"> 賃金台帳</label>
                    <label><input type="checkbox" name="books" value="8" v-model="form.books"> 在庫表</label>
                    <label><input type="checkbox" name="books" value="9" v-model="form.books"> 現金収支日報</label>
                    <label><input type="checkbox" name="books" value="10" v-model="form.books"> 会計日記帳</label>
                    <div class="flex-row full-width">
                        <label><input type="checkbox" name="books" value="99" v-model="form.books"> その他</label>
                        <input type="text" id="books_others" name="books_others" v-model="form.books_others" :disabled="!form.books.includes('99')" placeholder="その他の帳簿" class="input-mid">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="slip_count">1ヶ月の伝票枚数</label>
                <div class="form-control-wrapper">
                    <input type="number" id="slip_count" name="slip_count" v-model="form.slip_count" class="input-mid text-right"> 枚程度
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">経理担当者の有無</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="accounting_staff" value="1" v-model="form.accounting_staff"> あり</label>
                    <label><input type="radio" name="accounting_staff" value="0" v-model="form.accounting_staff"> なし</label>
                </div>
            </div>
        </div>

        <h2>契約内容</h2>
        <div class="section">
            <div class="form-group">
                <label class="form-label required" for="start_date">関与開始日</label>
                <div class="form-control-wrapper">
                    <input type="date" id="start_date" name="start_date" v-model="form.start_date" required>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">前関与税理士</label>
                <div class="form-control-wrapper flex-column">
                    <div class="flex-row">
                         <label><input type="radio" name="pre_accountant_exist" value="1" v-model="form.pre_accountant_exist"> あり</label>
                         <label><input type="radio" name="pre_accountant_exist" value="0" v-model="form.pre_accountant_exist"> なし (新規開業)</label>
                    </div>
                    <div v-if="form.pre_accountant_exist == '1'" style="margin-top: 10px; width: 100%;">
                        <input type="text" id="pre_accountant_name" name="pre_accountant_name" v-model="form.pre_accountant_name" placeholder="事務所名" style="margin-bottom:5px;">
                        <div class="flex-row">
                            <input type="text" id="pre_reward_tax" name="pre_reward_tax" :value="form.pre_reward_tax | formatNumber" @input="updateNumber($event, 'pre_reward_tax')" placeholder="前報酬(税務)" class="input-mid text-right">
                            <input type="text" id="pre_reward_account" name="pre_reward_account" :value="form.pre_reward_account | formatNumber" @input="updateNumber($event, 'pre_reward_account')" placeholder="前報酬(会計)" class="input-mid text-right">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">関与形態 (今回)</label>
                <div class="form-control-wrapper">
                    <label><input type="radio" name="contract_type" value="1" v-model="form.contract_type"> 毎月</label>
                    <label><input type="radio" name="contract_type" value="2" v-model="form.contract_type"> 隔月(2)</label>
                    <label><input type="radio" name="contract_type" value="3" v-model="form.contract_type"> 隔月(3)</label>
                    <label><input type="radio" name="contract_type" value="4" v-model="form.contract_type"> 年一</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="incharge_name">社内担当者</label>
                <div class="form-control-wrapper">
                    <input type="text" id="incharge_name" name="incharge_name" v-model="form.incharge_name" placeholder="担当者名" required>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="introducer_name">紹介者</label>
                <div class="form-control-wrapper">
                      <input type="text" id="introducer_name" name="introducer_name" v-model="form.introducer_name" placeholder="紹介者名">
                </div>
            </div>
            <div class="form-group">
                 <label class="form-label">紹介者区分</label>
                 <div class="form-control-wrapper">
                      <label><input type="radio" name="introducer_type" value="1" v-model="form.introducer_type"> 顧問先</label>
                      <label><input type="radio" name="introducer_type" value="2" v-model="form.introducer_type"> 金儲機関</label>
                      <label><input type="radio" name="introducer_type" value="0" v-model="form.introducer_type"> なし</label>
                 </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="background">きっかけ (経緯)</label>
                <div class="form-control-wrapper">
                    <textarea id="background" name="background" v-model="form.background" placeholder="契約に至った経緯..." required></textarea>
                </div>
            </div>
        </div>

        <h2>添付書類</h2>
        <div class="section">
            <div class="form-group">
                <label class="form-label" for="file_estimate">見積書 (PDF)</label>
                <div class="form-control-wrapper">
                    <input type="file" id="file_estimate" name="file_estimate" accept=".pdf" @change="handleFileUpload($event, 'file_estimate')">
                </div>
            </div>
        </div>
        
        <div class="btn-area">
            <button type="submit" class="btn btn-primary" :disabled="isSubmitting">申請する</button>
        </div>

    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://ajaxzip3.github.io/ajaxzip3.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="../assets/js/jquery.autoKana.js"></script> 
<script src="../assets/js/main.js"></script>
<script src="../assets/js/modules/contract_form.js"></script>

</body>
</html>